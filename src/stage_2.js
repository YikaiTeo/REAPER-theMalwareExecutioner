var Greenline;
var Redline;
var fButton;
var jButton;
var fPressed = false;
var jPressed = false;
var Greenmail;
var Redmail;

class stage_2 extends Phaser.Scene {
  constructor() {
    super({ key: "stage_2" });
  }

  preload() {
    this.load.svg("background2", "src/assets/stage2bg.svg", {
      width: 1280,
      height: 720
    });
    this.load.svg("SL_bitmap", "src/assets/safeline_bitmap.svg", {
      width: 960.15,
      height: 91.66
    });
    this.load.svg("green", "src/assets/greenLine.svg", {
      width: 898.02,
      height: 4
    });
    this.load.svg("red", "src/assets/redLine.svg", {
      width: 898.02,
      height: 4
    });
    this.load.svg("f_button", "src/assets/F_button.svg", {
      width: 130.28,
      height: 108.43
    });
    this.load.svg("j_button", "src/assets/J_button.svg", {
      width: 130.28,
      height: 108.43
    });
    this.load.svg("gMail", "src/assets/greenMail.svg", {
      width: 92.27,
      height: 69.8
    });
    this.load.svg("rMail", "src/assets/redMail.svg", {
      width: 92.27,
      height: 69.8
    });
    this.load.image("phishing", "src/assets/phishing_scam_villain.png");
  }

  create() {
    this.background = this.add.image(640, 360, "background2");
    this.villain = this.add.image(680, 250, "phishing");

    this.main()

    this.mails(640, 200)
    // graphics ▲
    // keyboards input ▼
    this.keyF = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F);
    this.keyJ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.J);
    // for debug ▼
    this.key1 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ONE);
  }

  main() {
    this.bitmap = this.add.image(640, 550, "SL_bitmap");
    Greenline = this.physics.add.image(640, 550, "green");
    Redline = this.physics.add.image(640, 550, "red");
    fButton = this.add.image(214, 550, "f_button");
    jButton = this.add.image(1066, 550, "j_button");
  }

  mails(x, y) {
    Greenmail = this.physics.add.image(x, y, "gMail");
    Greenmail.setVelocityY(50);
    this.physics.add.overlap(Greenmail, Greenline, this.passed, null, this);
  }

  passed() {
    if(this.keyJ.isDown && fPressed == false) {
      Greenmail.setActive(false);
      Greenmail.setVisible(false);
    }
  }

  update() {
    if(this.keyF.isDown && jPressed == false) {
      fButton.clearTint();
      Redline.setActive(true);
      Redline.setVisible(true);
      fPressed = true;
    } else {
      fButton.setTint(0x7E7E7E);
      Redline.setActive(false);
      Redline.setVisible(false);
      fPressed = false;
    }
    if(this.keyJ.isDown && fPressed == false) {
      jButton.clearTint();
      Greenline.setActive(true);
      Greenline.setVisible(true);
      jPressed = true;
    } else {
      jButton.setTint(0x7E7E7E);
      Greenline.setActive(false);
      Greenline.setVisible(false);
      jPressed = false;
    }

    // for debug ▼
    if (this.key1.isDown) {
      this.scene.stop("stage_2");
      this.scene.start("preloadScene");
    }
  }
}