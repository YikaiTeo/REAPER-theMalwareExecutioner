// audio's var ▼
var changeTab;
var Transition;
// windows' var ▼
var start;
var startClicked = 2;
var goToWebsite;
var closeWindow;
// stages and stages selection's var ▼
var stage1;
var stage2;
var stage3;
var stage4;
var goToStage1 = false;
var goToStage2 = false;
var goToStage3 = false;

class preloadScene extends Phaser.Scene {
  constructor() {
    super({ key: "preloadScene" });
  }

  preload() {
    // audio files
    this.load.audio("tab", [
      "src/assets/audio/mixkit-arcade-retro-changing-tab-206.mp3"
    ]);
    this.load.audio("transition", [
      "src/assets/audio/mixkit-arcade-retro-jump-223.mp3"
    ]);
    // image files
    this.load.svg("background", "src/assets/preloadbg.svg", {
      width: 1280,
      height: 720
    });
    this.load.svg("window", "src/assets/preloadWindow.svg", {
      width: 1280,
      height: 720
    });
    this.load.svg("stageSelection", "src/assets/stageWindow.svg", {
      width: 1280,
      height: 720
    });
    this.load.image("X", "src/assets/X.png");
    this.load.svg("stage1", "src/assets/stage_1.svg", {
      width: 92.5,
      height: 101.5
    });
    this.load.svg("stage2", "src/assets/stage_2.svg", {
      width: 92.5,
      height: 101.5
    });
    this.load.svg("stage3", "src/assets/stage_3.svg", {
      width: 92.5,
      height: 101.5
    });
    this.load.svg("stage4", "src/assets/stage_4.svg", {
      width: 92.5,
      height: 101.5
    });
  }

  create() {
    this.background = this.add.image(640, 360, "background");
    // for debug ▼
    this.key1 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ONE);
    this.key2 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.TWO);
    this.key3 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.THREE);

    this.preloadWindow();
  }

  preloadWindow() {
    var start_x = 375;
    var start_y = 330;
    var website_x = 375;
    var website_y = 395.5;

    console.log("preload window");
    changeTab = this.sound.add("tab");
    Transition = this.sound.add("transition")
    this.background = this.add.image(640, 360, "window");

    start = this.add
      .text(start_x, start_y, "START", { fontFamily: "DisposableDroidBB" })
      .setFontSize(50)
      .setInteractive();
    goToWebsite = this.add
      .text(website_x, website_y, "Visit website", {fontFamily: "DisposableDroidBB"})
      .setFontSize(40)
      .setInteractive();

    start.on("pointerdown", function () {
      console.log("pointer on 'Start'");
      changeTab.play();
      start.setScale(1.25).setPosition(start_x - 15, start_y - 7);
    });
    start.on("pointerup", function () {
      start.setScale(1).setPosition(start_x, start_y);
      startClicked = 1;
      console.log(startClicked);
    });

    goToWebsite.on("pointerdown", function () {
      console.log("pointer on 'Visit website'");
      changeTab.play();
      goToWebsite.setScale(1.25).setPosition(website_x - 15, website_y - 7);
    });
    goToWebsite.on("pointerup", function () {
      goToWebsite.setScale(1).setPosition(website_x, website_y);
      window.open("https://yikaiartisn.wixsite.com/whatcouldgowrong", "_blank");
    });
  }

  stageSelectionWindow(x, y) {
    console.log("stage selection window");
    this.stageSelection = this.add.image(640, 360, "stageSelection");

    closeWindow = this.add
      .image(1093.5, 91, "X")
      .setScale(0.478)
      .setInteractive();

    // stage icons ▼
    stage1 = this.add.image(x, y, "stage1").setInteractive();
    stage1.setTint(0x7e7e7e);
    stage2 = this.add.image(x + 121, y, "stage2").setInteractive();
    stage3 = this.add.image(x + 242, y, "stage3").setInteractive();
    stage4 = this.add.image(x + 363, y, "stage4").setInteractive();
    stage4.setTint(0x7e7e7e);

    // stage1.on("pointerdown", function () {
    //   changeTab.play();
    //   stage1.setScale(1.1);
    // });
    // stage1.on("pointerup", function () {
    //   stage1.setScale(1);
    //   goToStage1 = true;
    // });

    stage2.on("pointerdown", function () {
      changeTab.play();
      stage2.setScale(1.1);
    });
    stage2.on("pointerup", function () {
      stage2.setScale(1);
      goToStage2 = true;
    });

    stage3.on("pointerdown", function () {
      changeTab.play();
      stage3.setScale(1.1);
    });
    stage3.on("pointerup", function () {
      stage3.setScale(1);
      goToStage3 = true;
    });

    closeWindow.on("pointerdown", function () {
      changeTab.play();
      startClicked = 0;
      console.log(startClicked);
    });
  }

  update() {
    if (startClicked == 0) {
      this.preloadWindow();
      startClicked = 2;
    } else if (startClicked == 1) {
      this.stageSelectionWindow(450, 290);
      startClicked = 2;
    }

    if (goToStage1 == true) {
      goToStage1 = false;
      console.log("going to stage 1...");
      Transition.play();
      this.scene.stop("preloadScene");
      this.scene.start("stage_1");
    }
    if (goToStage2 == true) {
      goToStage2 = false;
      console.log("going to stage 2...");
      Transition.play();
      this.scene.stop("preloadScene");
      this.scene.start("intructions2");
    }
    if (goToStage3 == true) {
      goToStage3 = false;
      console.log("going to stage 3...");
      Transition.play();
      this.scene.stop("preloadScene");
      this.scene.start("intructions3");
    }

    // for debug ▼
    // if (this.key1.isDown) {
    //   this.scene.stop("preloadScene");
    //   this.scene.start("stage_1");
    // }
    // if (this.key2.isDown) {
    //   this.scene.stop("preloadScene");
    //   this.scene.start("stage_2");
    // }
    // if (this.key3.isDown) {
    //   this.scene.stop("preloadScene");
    //   this.scene.start("stage_3");
    // }
  }
}