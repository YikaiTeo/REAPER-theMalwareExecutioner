var changeTab;
var start;
var startClicked = 0;
var goToWebsite;
var closeWindow;
var stage1;
var stage2;
var stage3;
var stage4;

class preloadScene extends Phaser.Scene {
  constructor() {
    super({ key: "preloadScene" });
  }

  preload() {
    // audio files
    this.load.audio("tab", ["src/assets/audio/mixkit-arcade-retro-changing-tab-206.mp3"]);
    // image files
    this.load.svg("background", "src/assets/preloadbg.svg", { width: 1280, height: 720 });
    this.load.image("window", "src/assets/preloadWindow.png");
    this.load.image("stageSelection", "src/assets/stageWindow.png");
    this.load.image("X", "src/assets/X.png");
    this.load.image("frame", "src/assets/stage.png");
  }

  create() {
    this.background = this.add.image(640, 360, "background");
    // for debug ▼
    this.key2 = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.TWO);
  }

  preloadWindow() {
    console.log("preload window");
    changeTab = this.sound.add("tab");
    this.background = this.add.image(640, 360, "window").setScale(0.478);

    start = this.add
      .text(370, 300, "START", { fontFamily: "DisposableDroidBB" })
      .setFontSize(60)
      .setInteractive();
    goToWebsite = this.add
      .text(370, 370, "Visit website", { fontFamily: "DisposableDroidBB" })
      .setFontSize(40)
      // .setStroke("#12161B", 5)
      .setInteractive();

    start.on("pointerdown", function () {
      console.log("pointer on 'Start'");
      changeTab.play();
      start.setScale(1.25).setPosition(355, 285);
    });
    start.on("pointerup", function () {
      start.setScale(1).setPosition(370, 300);
      startClicked = 1;
      console.log(startClicked);
    });

    goToWebsite.on("pointerdown", function () {
      console.log("pointer on 'Visit website'");
      changeTab.play();
      goToWebsite.setScale(1.25).setPosition(355, 355);
    });
    goToWebsite.on("pointerup", function () {
      goToWebsite.setScale(1).setPosition(370, 370);
      window.open("https://yikaiartisn.wixsite.com/whatcouldgowrong", "_blank");
    });
  }

  stageSelectionWindow(x, y) {
    console.log("stage selection window");
    this.stageSelection = this.add.image(640, 360, "stageSelection").setScale(0.478);
    
    closeWindow = this.add.image(1090, 65, "X").setScale(0.478).setInteractive();

    // stage icons ▼
    stage1 = this.add.image(x, y, "frame").setScale(0.478);
    stage2 = this.add.image(x + 125, y, "frame").setScale(0.478);
    stage3 = this.add.image(x + 250, y, "frame").setScale(0.478);
    stage4 = this.add.image(x + 375, y, "frame").setScale(0.478);
    // stage texts ▼
    this.add
      .text(x - 46, y + 60, "stage_1", { fontFamily: "DisposableDroidBB" })
      .setFontSize(25);
    this.add
      .text(x + 79, y + 60, "stage_2", { fontFamily: "DisposableDroidBB" })
      .setFontSize(25);
    this.add
      .text(x + 204, y + 60, "stage_3", { fontFamily: "DisposableDroidBB" })
      .setFontSize(25);
    this.add
      .text(x + 329, y + 60, "stage_4", { fontFamily: "DisposableDroidBB" })
      .setFontSize(25);

    closeWindow.on("pointerdown", function () {
      changeTab.play();
      startClicked = 0;
      console.log(startClicked);
    });
  }

  update() {
    if (startClicked == 0) {
      this.preloadWindow();
      startClicked = 2;
    } else if (startClicked == 1) {
      this.stageSelectionWindow(450, 240);
      startClicked = 2;
    }

    // for debug ▼
    if (this.key2.isDown) {
      this.scene.stop("preloadScene");
      this.scene.start("stage_2");
    }
  }
}